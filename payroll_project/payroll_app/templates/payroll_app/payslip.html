{% extends "payroll_app/base.html" %}

{% block title %}Payslip Generation{% endblock %}

{% block content %}
<div class="p-6">
    <h2 class="text-[#7768ae] font-bold text-2xl mb-6 flex items-center space-x-2">
        <img src="https://img.icons8.com/ios-filled/24/7768ae/payroll.png" alt="Payroll Icon"/>
        <span>Payslip Generation</span>
    </h2>

    <!-- Select Employee -->
    <form method="POST" class="flex flex-wrap space-x-4 mb-6 items-center">
        {% csrf_token %}
        <select name="employee" class="px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-[#00b9b9]">
            <option value="">Select Employee</option>
            {% for emp in employees %}
                <option value="{{ emp.id }}" {% if selected_employee and emp.id == selected_employee.id %}selected{% endif %}>
                    {{ emp.name }}
                </option>
            {% endfor %}
        </select>

        <button type="submit" class="px-4 py-2 bg-[#ff9b4b] text-white rounded hover:bg-[#7768ae]">
            Generate Payslip
        </button>
    </form>

    <!-- Payslip Display -->
    {% if selected_employee %}
    <div class="bg-white p-6 rounded shadow w-full md:w-3/4">
        <!-- Header -->
        <div class="text-center mb-6">
            <h3 class="text-xl font-bold text-[#7768ae]">Payroll System</h3>
            <p class="text-gray-600">Payslip for {{ selected_month }}</p>
        </div>

        <!-- Employee Details Table -->
        <table class="w-full border-collapse mb-4">
            <tbody>
                <tr class="border-b">
                    <th class="text-left py-2 px-4 font-semibold">Employee Name</th>
                    <td class="py-2 px-4">{{ selected_employee.name }}</td>
                    <th class="text-left py-2 px-4 font-semibold">Role</th>
                    <td class="py-2 px-4">{{ selected_employee.role }}</td>
                </tr>
                <tr class="border-b">
                    <th class="text-left py-2 px-4 font-semibold">Department</th>
                    <td class="py-2 px-4">{{ selected_employee.department }}</td>
                    <th class="text-left py-2 px-4 font-semibold">Join Date</th>
                    <td class="py-2 px-4">{{ selected_employee.join_date|date:"d M Y" }}</td>
                </tr>
            </tbody>
        </table>

        <!-- Salary Details Table -->
        <table class="w-full border-collapse mb-4">
            <tbody>
                <tr class="border-b">
                    <th class="text-left py-2 px-4 font-semibold">Base Salary</th>
                    <td class="py-2 px-4">â‚¹{{ selected_employee.salary }}</td>
                    <th class="text-left py-2 px-4 font-semibold">Bonus</th>
                    <td class="py-2 px-4">â‚¹{{ selected_employee.bonus }}</td>
                </tr>
                <tr class="border-b">
                    <th class="text-left py-2 px-4 font-semibold">Deductions</th>
                    <td class="py-2 px-4">â‚¹{{ selected_employee.deduction }}</td>
                    <th class="text-left py-2 px-4 font-semibold">Net Salary</th>
                    <td class="py-2 px-4 font-semibold text-[#00b9b9]">â‚¹{{ selected_employee.net_salary }}</td>
                </tr>
            </tbody>
        </table>

        <!-- Signature Section -->
        <div class="flex justify-between mt-8">
            <div class="text-center">
                <p class="font-semibold">Employee Signature</p>
                <div class="border-t w-40 mx-auto mt-2"></div>
            </div>
            <div class="text-center">
                <p class="font-semibold">Authorized Signature</p>
                <div class="border-t w-40 mx-auto mt-2"></div>
            </div>
        </div>

       <!-- Action Buttons -->
<div class="mt-6 flex space-x-4">
    <!-- Template Selection -->
    <form method="get" action="{% url 'download_payslip' selected_employee.id %}">
        <select name="template_id" class="px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-[#00b9b9]">
            <option value="1">Template 1</option>
            <option value="2">Template 2</option>
            <option value="3">Template 3</option>
            {% if user.is_premium %}
                <option value="4">Premium Template 4</option>
                <option value="5">Premium Template 5</option>
            {% else %}
                <option value="premium-warning" disabled>ðŸ”’ Premium Template 4 (Locked)</option>
                <option value="premium-warning" disabled>ðŸ”’ Premium Template 5 (Locked)</option>
            {% endif %}
        </select>

        <button type="submit" class="px-4 py-2 bg-[#ff9b4b] text-white rounded hover:bg-[#7768ae]">
            Download PDF
        </button>
    </form>

    <a href="{% url 'dashboard' %}" class="px-4 py-2 bg-[#00b9b9] text-white rounded hover:bg-[#7768ae]">
        Back to Dashboard
    </a>
</div>

    <!-- Premium Upgrade Instinct -->
    {% if not user.is_premium %}
    <div class="mt-6 p-4 bg-[#f3f0ff] border border-[#7768ae] rounded-lg shadow text-center">
        <h3 class="text-lg font-bold text-[#7768ae] mb-2">âœ¨ Unlock More Payslip Templates</h3>
        <p class="text-gray-600 mb-4">Get access to professional templates, advanced customization, and your company logo on payslips with <span class="font-semibold text-[#00b9b9]">Premium</span>.</p>
       <a href="{% url 'upgrade' %}" 
   class="px-4 py-2 bg-[#00b9b9] text-white rounded-lg hover:bg-[#7768ae]">
   Upgrade to Premium
</a>

    </div>
    {% endif %}

    {% endif %}
</div>
{% endblock %}
