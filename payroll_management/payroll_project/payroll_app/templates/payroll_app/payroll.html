{% extends "payroll_app/base.html" %}

{% block title %}Payroll Run{% endblock %}

{% block content %}
<div class="p-6">
    <h2 class="text-[#7768ae] font-bold text-2xl mb-6 flex items-center space-x-2">
        <img src="https://img.icons8.com/ios-filled/24/7768ae/payroll.png" alt="Payroll Icon"/>
        <span>Payroll Run</span>
    </h2>

    <!-- Month Selection & Run Payroll -->
    <form method="POST" class="flex flex-wrap space-x-4 mb-6 items-center">
        {% csrf_token %}
        <select name="month" class="px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-[#00b9b9]">
            <option value="">Select Month</option>
            {% for month in months %}
                <option value="{{ month }}" {% if month == selected_month %}selected{% endif %}>{{ month }}</option>
            {% endfor %}
        </select>
    
        <input type="text" id="employeeFilter" placeholder="Filter by name/role..." 
               class="px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-[#00b9b9] mt-2 sm:mt-0">
    </form>

    <!-- Employee Payroll Table -->
    <div class="bg-white p-4 rounded shadow overflow-x-auto">
        <table class="min-w-full table-auto" id="payrollTable">
            <thead class="bg-[#00b9b9] text-white">
                <tr>
                    <th class="px-4 py-2">ID</th>
                    <th class="px-4 py-2">Name</th>
                    <th class="px-4 py-2">Role</th>
                    <th class="px-4 py-2">Base Salary</th>
                    <th class="px-4 py-2">Bonus</th>
                    <th class="px-4 py-2">Deductions</th>
                        <th class="px-4 py-2">Net Salary</th>
                    <th class="px-4 py-2">Status</th>
                </tr>
            </thead>
            <tbody>
                {% for emp in employees %}
                <tr class="text-center border-b hover:bg-gray-50 transition">
                    <td class="px-4 py-2">{{ emp.id }}</td>

                    <td class="px-4 py-2">
                        <div class= "flex items-center space-x-1 justify-center">
                        <img src="https://img.icons8.com/ios-glyphs/20/7768ae/user.png" alt="User Icon"/>
                        <span>{{ emp.name }}</span>
                    </td>
                    <td class="px-4 py-2">
                        <div class= "flex items-center justify-center space-x-1">
                        <img src="https://img.icons8.com/ios-glyphs/20/7768ae/briefcase.png" alt="Role Icon"/>
                        <span>{{ emp.role }}</span>
                    </td>
                    <td class="px-4 py-2">₹{{ emp.salary }}</td>
                    <td class="px-4 py-2">₹{{ emp.bonus }}</td>
                    <td class="px-4 py-2">₹{{ emp.deduction }}</td>
                    <td class="px-4 py-2 font-semibold text-[#00b9b9]">₹{{ emp.net_salary }}</td>
                    <td class="px-4 py-2">
                        <span class="px-2 py-1 rounded text-white 
                                     {% if emp.status == 'Calculated' %}bg-green-500{% else %}bg-gray-400{% endif %}">
                            {{ emp.status }}
                        </span>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="8" class="text-center py-4 text-gray-500">No employees found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Filter Script -->
<script>
    const filterInput = document.getElementById('employeeFilter');
    filterInput.addEventListener('keyup', function() {
        const filterValue = this.value.toLowerCase();
        const table = document.getElementById('payrollTable');
        const rows = table.getElementsByTagName('tr');

        for (let i = 1; i < rows.length; i++) {
            const name = rows[i].cells[1].textContent.toLowerCase();
            const role = rows[i].cells[2].textContent.toLowerCase();
            rows[i].style.display = (name.includes(filterValue) || role.includes(filterValue)) ? '' : 'none';
        }
    });
</script>
{% endblock %}
